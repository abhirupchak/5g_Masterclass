## Registration

When a device has either mvoed to a new cell or is connecting to the network for the first time or some other situation, it needs to go through the registration procedure
![registration](https://github.com/user-attachments/assets/933ee4c2-9f66-400f-a93a-c57626461972)

For a simple registration the process is as follows:

- 1.The UE sends the request to nearby RAN which assigns an AMF to the device in one of two ways,
    either it takes the GUTI(Device Identifier) from the device and assigns it the corresponding AMF it was connected to or it accesses the NSSAI(network slice selection assistance information)
    to know what AMF supports the network slice and thus foward the request.

- 2.**Context Transfer**: Due to device mobility, AMF needs to be switched to a nearby one, in this case new AMF contacts old AMF for UE context transfer.
- 3.**Authentication and Security**
- 4.**Context Transfer Completion**: New AMF confirms with old AMF that context has been successfully transferred.
- 5.**NewAMF to UDM**: New AMF registers with UDM for relevant device and subscription information as well as subscribes to UDM for further subscription updates. Old AMF deregisters with UDM and unsubscribes.
- 6.**Policy Information**: New AMF contacts PCF for relevant policy information about the UE.
- 7.**PDU Session Continued/Started**: PDU session can be continued or stopped(in case of error) with contact with SMF
- 8.**Registration Complete**:Registration completed message is sent by RAN to UE
- 9.**Policy Updation**: Any new or updated policies can be fetched from PCF

![completeregistrationprocess](https://github.com/user-attachments/assets/bebdd4fe-8e4a-487c-82e2-c915b1e93fe1)

## Deregistration

When devices no longer needs to access 5G services or network kicks the device out it deregisters.

Similar to registration there are a list of procedures(call flow) that occur,

![deregistration_complete](https://github.com/user-attachments/assets/91cf7b78-d5a3-4d54-b043-cd35e075623c)

## PDU Session Establishment Procedure

This procedure takes place in following scenarios,

![pdusessionesttrigger](https://github.com/user-attachments/assets/eb334fc5-6003-4df8-9d9b-4ec07b786ab0)

1. **PDU Session Establishment Request**
   - The UE (User Equipment) sends a PDU session establishment request to the RAN (Radio Access Network).

2. **SMF Selection**
   - The RAN communicates with the AMF (Access and Mobility Management Function) to select the appropriate SMF (Session Management Function).
   - The AMF sends an `Nsmf_PDUSession_CreateSMContextRequest` to the selected SMF.
   - The SMF interacts with the UDM (Unified Data Management) via `Nudm_SDM_Get` and `Nudm_SDM_Subscribe` to retrieve and subscribe to user data.
   - The SMF responds to the AMF with `Nsmf_PDUSession_CreateSMContextResponse`.

3. **PDU Session Authentication/Authorization**
   - The AMF authenticates and authorizes the PDU session with the SMF and UDM involved.

4. **PCF and UPF Selection**
   - The AMF selects the PCF (Policy Control Function) and communicates via `Npcf_SMPolicyControl_Create`.
   - The AMF selects the UPF (User Plane Function) for N4 session establishment.

5. **N2 Request**
   - The AMF sends an `N2 Request` (NAS PDU Session Establishment Accept, N2 PDU Session Information) to the RAN.
   - The RAN forwards the NAS message and sets up AN (Access Network) user plane resources.

6. **RRC Reconfiguration**
   - The RAN performs RRC (Radio Resource Control) reconfiguration to set up the connection between the UE and the network.
   - `N2 Request ACK` is sent back to the AMF.

7. **First Uplink Data**
   - The UE sends the first uplink data after the PDU session is established.

8. **First Downlink Data**
   - The network sends the first downlink data after the session is fully established.
   - The SMF updates the PDU session context via `Nsmf_PDUSession_UpdateSMContextRequest` and `Nsmf_PDUSession_UpdateSMContextResponse`.

9. **Registration Update**
   - The UE updates its registration status with `Nudm_UECM_Registration`.


![completepdusessionoverview](https://github.com/user-attachments/assets/10388bcb-ad98-4cfd-baf9-06169759c26d)
